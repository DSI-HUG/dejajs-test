<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for dejajs-components/src/common/util/JsonUtils.ts</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../../prettify.css" />
    <link rel="stylesheet" href="../../../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../../../index.html">All files</a> / <a href="index.html">dejajs-components/src/common/util</a> JsonUtils.ts
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">19.15% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>9/47</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/32</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">9.09% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>1/11</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">20% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>8/40</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/*
 *  @license
 *  Copyright Hôpitaux Universitaires de Genève. All Rights Reserved.
 *
 *  Use of this source code is governed by an Apache-2.0 license that can be
 *  found in the LICENSE file at https://github.com/DSI-HUG/dejajs-components/blob/master/LICENSE
 */
&nbsp;
export class JsonUtils {
    /**
     * Cache for getOneFrom() method
     */
    private static mapCaches: any = {};
&nbsp;
    /**
     * deserializeJson is a method to deserialize a json into a typed object. The &lt;T&gt; say that we want to 'capture' the object type so we can return it.
     * More details : www.typescriptlang.org/docs/handbook/generics.html
     *
     * /!\ this is not a recursive function !
     *      Object into object will stay as generic objects.
     *      Re-use this function to deserialize them into typed objects.
     *
     * Usage : var obj = JsonUtils.deserializeJson(new TypedObj(), aJSON);
     *          Where TypedObj is a valid TypeScript class.
     *          After that, obj.constructor.name will be TypedObj
     * {
    * Example of use : plnkr.co/edit/11b0kzypP0N9I9B8AqPx?p=preview
    *
     * @param obj Object to deserialize into
     * @param jsonObj a JSON;
     *
     * @return an object of 'T' type
     */
<span class="fstat-no" title="function not covered" >    public static deserializeJson&lt;T&gt;(</span>obj: T, jsonObj: any): T {
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (typeof jsonObj === 'string') {</span>
<span class="cstat-no" title="statement not covered" >            jsonObj = JSON.parse(jsonObj);</span>
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        Object.keys(jsonObj).forEach(<span class="fstat-no" title="function not covered" >(</span>propName) =&gt; {</span>
<span class="cstat-no" title="statement not covered" >            if (!(jsonObj[propName] instanceof Object)) {</span>
<span class="cstat-no" title="statement not covered" >                obj[propName] = jsonObj[propName];</span>
            }
        });
&nbsp;
<span class="cstat-no" title="statement not covered" >        return obj;</span>
    }
&nbsp;
    /**
     * DeserializeJson is a method to deserialize a json into a typed object. The instance is created during the call. Not recursive.
     * &lt;p&gt; Th Boolean value will be casted automatically form string to &lt;code&gt;boolean&lt;/code&gt;&lt;/p&gt;
     * &lt;p&gt; Exemple:
     *     &lt;code&gt;let newObj:MyClass = deserializeJson&lt;MyClass&gt;(MyClass&gt;,jsonObj);&lt;/code&gt;
     * &lt;/p&gt;
     * &lt;p&gt;note: It's possible than The object generate can old more properties than the one in the class&lt;/p&gt;
     * &lt;p&gt;note2: Require an empty constructor for the serialized class&lt;/p&gt;
     * @param clazz The class of the object created
     * @param sourceObj The JSON object
     * @param caseTransform
     * @returns An object of 'T' type
     */
<span class="fstat-no" title="function not covered" >    public static deserializeJson2&lt;T&gt;(</span>clazz: { new (): T }, sourceObj: any, <span class="cstat-no" title="statement not covered" >caseTransform = false)</span>: T {
        const castedObj: T = <span class="cstat-no" title="statement not covered" >new clazz();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        for (const sourcePropName in sourceObj) {</span>
<span class="cstat-no" title="statement not covered" >            if (sourceObj.hasOwnProperty(sourcePropName)) {</span>
                const targetPropName = <span class="cstat-no" title="statement not covered" >caseTransform ? sourcePropName.toLowerCase() : sourcePropName;</span>
                // Boolean managment
                const value = <span class="cstat-no" title="statement not covered" >sourceObj[sourcePropName] </span>;
<span class="cstat-no" title="statement not covered" >                if (value &amp;&amp; !(value instanceof Array) &amp;&amp; value.length === 4 &amp;&amp; (value.toLowerCase() === 'true' ||  value.toLowerCase() === 'false')) {</span>
<span class="cstat-no" title="statement not covered" >                    castedObj[targetPropName] = JSON.parse(value.toLowerCase());</span>
                } else {
<span class="cstat-no" title="statement not covered" >                    castedObj[targetPropName] = value;</span>
                }
            }
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        return castedObj;</span>
    }
&nbsp;
    /**
     * Like deserializeJson2, but for a list of objects
     * @param clazz
     * @param sourceList
     * @param caseTransform
     * @return An array of object of 'T' type
     */
<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >    public static deserializeJsonList&lt;T&gt;(</span>clazz: { new (): T }, sourceList: any[], <span class="cstat-no" title="statement not covered" >caseTransform = false)</span>: T[] {</span>
<span class="cstat-no" title="statement not covered" >        return sourceList.map(<span class="fstat-no" title="function not covered" >(</span>sourceObj) =&gt; <span class="cstat-no" title="statement not covered" >this.deserializeJson2&lt;T&gt;(clazz, sourceObj, caseTransform))</span>;</span>
    }
&nbsp;
    /**
     * Convert a list of object into a "Map Object" where attributes name are IDs and values are the objects
     * @param objList : List of object with an attribute "id" or "ID" or "Id"
     * @param idFieldName : Field name to use insetead of id.
     * @return a map
     */
<span class="fstat-no" title="function not covered" >    public static toMap(</span>objList: any[], <span class="cstat-no" title="statement not covered" >idFieldName: string = null)</span>: any {
        const mapObj: any = <span class="cstat-no" title="statement not covered" >{};</span>
<span class="cstat-no" title="statement not covered" >        objList.forEach(<span class="fstat-no" title="function not covered" >(</span>obj: any) =&gt; {</span>
<span class="cstat-no" title="statement not covered" >            if (idFieldName) {</span>
<span class="cstat-no" title="statement not covered" >                mapObj[obj[idFieldName]] = obj;</span>
            } else {
<span class="cstat-no" title="statement not covered" >                mapObj[obj.id || obj.ID || obj.Id] = obj;</span>
            }
        });
<span class="cstat-no" title="statement not covered" >        return mapObj;</span>
    }
&nbsp;
    /**
     * Get an object from a array of object. It uses a cache in order to go faster if called in a loop.
     * @param listPromise Promise that returns a array of objects. Object can have an an attribute "id" or "ID" or "Id" or field named by the 'idFieldName' param.
     * @param id: The ID we want to get
     * @param cacheName: The cache key to store it
     * @param idFieldName : Field name to use insetead of id.
     * @return One Promise with the selected element
     */
<span class="fstat-no" title="function not covered" >    public static getOneFrom(</span>listPromise: Promise&lt;any&gt;, id: string, cacheName: string, <span class="cstat-no" title="statement not covered" >idFieldName: string = null)</span>: Promise&lt;any&gt; {
        let currentcache = <span class="cstat-no" title="statement not covered" >JsonUtils.mapCaches[cacheName];</span>
<span class="cstat-no" title="statement not covered" >        return new Promise&lt;any&gt;(<span class="fstat-no" title="function not covered" >(</span>resolve) =&gt; {</span>
<span class="cstat-no" title="statement not covered" >            if (id) {</span>
<span class="cstat-no" title="statement not covered" >                if (currentcache) {</span>
<span class="cstat-no" title="statement not covered" >                    resolve(currentcache[id]);</span>
                } else {
<span class="cstat-no" title="statement not covered" >                    listPromise.then(<span class="fstat-no" title="function not covered" >(</span>allObjs) =&gt; {</span>
<span class="cstat-no" title="statement not covered" >                        currentcache = JsonUtils.toMap(allObjs, idFieldName);</span>
<span class="cstat-no" title="statement not covered" >                        JsonUtils.mapCaches[cacheName] = currentcache;</span>
<span class="cstat-no" title="statement not covered" >                        resolve(currentcache[id]);</span>
                    });
                }
            } else {
<span class="cstat-no" title="statement not covered" >                resolve(null);</span>
            }
        });
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Fri Nov 24 2017 14:23:26 GMT+0000 (UTC)
</div>
</div>
<script src="../../../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../../../sorter.js"></script>
</body>
</html>
